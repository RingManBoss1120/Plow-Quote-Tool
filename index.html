<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MN Plowing Quote Tool</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-180.png">

<style>
body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background:#f4f6f8;
  margin:0;
  padding:12px;
}

.card{
  background:#fff;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 2px 8px rgba(0,0,0,.06)
}

label{
  font-weight:600;
  display:block;
  margin-bottom:6px
}

input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:16px
}

button{
  padding:12px;
  border-radius:12px;
  border:0;
  background:#111;
  color:#fff;
  font-weight:700;
  font-size:16px;
  width:100%;
  margin-top:8px
}

button.ghost{
  background:#eee;
  color:#111
}

.btnRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap
}

.btnRow button{
  flex:1
}

.muted{
  color:#666;
  font-size:13px
}
</style>
</head>

<body>

<!-- LOGO HEADER -->
<div class="card" style="text-align:center;">
  <img src="MN%20Plowing%20Logo%20no%20back.png"
       alt="MN Plowing Logo"
       style="max-width:340px;width:100%;height:auto;">
</div>

<!-- CUSTOMER -->
<div class="card">
  <label>Customer Name</label>
  <input id="custName" placeholder="John Smith">
</div>

<div class="card">
  <label>Service Address</label>
  <input id="custAddr" list="addrList" placeholder="123 Main St, Duluth">
  <datalist id="addrList"></datalist>
</div>

<div class="card">
  <label>Zone / Cluster</label>
  <input id="zone">

  <label style="margin-top:10px;">Service</label>
  <select id="service">
    <option value="plow">Driveway only</option>
    <option value="sidewalk">Sidewalk only</option>
    <option value="plow_sw">Driveway + Sidewalk</option>
  </select>
</div>

<!-- DRIVEWAY -->
<div class="card">
  <label>Driveway Minutes</label>
  <input id="drvMin" type="number" step="0.1">

  <label style="margin-top:10px;">Target $ / Hour</label>
  <input id="targetHr" value="400">

  <label style="margin-top:10px;">Minimum Driveway Charge</label>
  <input id="minDrv" value="35">
</div>

<!-- SIDEWALK -->
<div class="card">
  <label>Sidewalk Minutes</label>
  <input id="swMin" value="0">

  <label style="margin-top:10px;">Sidewalk $ per minute</label>
  <select id="swRate">
    <option value="4" selected>$4 / min</option>
    <option value="5">$5 / min</option>
    <option value="6">$6 / min</option>
    <option value="7">$7 / min</option>
    <option value="8">$8 / min</option>
  </select>
</div>

<!-- TOTALS -->
<div class="card">
  <div>Driveway: <b id="drvOut">$0.00</b></div>
  <div>Sidewalk: <b id="swOut">$0.00</b></div>
  <div style="margin-top:6px;">Total: <b id="totOut">$0.00</b></div>
</div>

<!-- NOTES -->
<div class="card">
  <label>Notes</label>
  <textarea id="notes"></textarea>
</div>

<!-- ACTIONS -->
<div class="card">
  <div class="btnRow">
    <button id="copyBtn">Copy Quote</button>
    <button id="clearBtn" class="ghost">Clear</button>
  </div>
</div>

<!-- SAVED -->
<div class="card">
  <b>Saved Quotes</b>
  <div class="btnRow" style="margin-top:10px;">
    <button id="saveBtn">Save Quote</button>
    <button id="exportBtn" class="ghost">Export CSV</button>
    <button id="clearSavedBtn" class="ghost">Clear Saved</button>
  </div>
  <div id="savedList" style="margin-top:10px;"></div>
</div>

<script>
function money(n){
  return new Intl.NumberFormat("en-US",{
    style:"currency",
    currency:"USD"
  }).format(n||0);
}

const fields=["custName","custAddr","zone","service","drvMin","targetHr","minDrv","swMin","swRate","notes"];
const SAVED="mn_quotes_v1";

function calc(){
  let perMin=document.getElementById("targetHr").value/60;
  let drvMin=+drvMinEl().value||0;
  let minDrv=+minDrvEl().value||0;

  let drv=drvMin*perMin;
  if(drvMin>0) drv=Math.max(drv,minDrv);

  let sw= (+swMinEl().value||0) * (+swRateEl().value||0);

  drvOut.textContent=money(drv);
  swOut.textContent=money(sw);

  let s=service.value;
  let tot=(s==="plow")?drv:(s==="sidewalk")?sw:drv+sw;

  totOut.textContent=money(tot);

  return {drv,sw,tot};
}

function drvMinEl(){return document.getElementById("drvMin")}
function minDrvEl(){return document.getElementById("minDrv")}
function swMinEl(){return document.getElementById("swMin")}
function swRateEl(){return document.getElementById("swRate")}

function getSaved(){return JSON.parse(localStorage.getItem(SAVED)||"[]")}
function setSaved(a){localStorage.setItem(SAVED,JSON.stringify(a))}

function renderSaved(){
  let a=getSaved().reverse();
  savedList.innerHTML=a.length?a.map((q,i)=>`
  <div class="card">
    <b>${q.custName}</b><br>
    ${q.custAddr}<br>
    Total: ${money(q.tot)}<br>
    <div class="btnRow">
      <button class="ghost" onclick="loadQ(${i})">Load</button>
      <button class="ghost" onclick="delQ(${i})">Delete</button>
    </div>
  </div>`).join(""):"<div class='muted'>No saved quotes</div>";

  addrList.innerHTML=[...new Set(a.map(q=>q.custAddr))].map(x=>`<option value="${x}">`).join("");
}

function saveQuote(){
  if(!custAddr.value){alert("Enter address");return;}
  let {drv,sw,tot}=calc();
  let q={};
  fields.forEach(f=>q[f]=document.getElementById(f).value);
  q.drv=drv; q.sw=sw; q.tot=tot;
  setSaved([...getSaved(),q]);
  renderSaved();
}

function loadQ(i){
  let q=getSaved().reverse()[i];
  fields.forEach(f=>document.getElementById(f).value=q[f]);
  calc();
}

function delQ(i){
  let a=getSaved().reverse();
  a.splice(i,1);
  setSaved(a.reverse());
  renderSaved();
}

function exportCSV(){
  let a=getSaved();
  let csv="Customer,Address,Total\n"+a.map(q=>`${q.custName},${q.custAddr},${q.tot}`).join("\n");
  let b=new Blob([csv]);
  let u=URL.createObjectURL(b);
  let l=document.createElement("a");
  l.href=u;l.download="quotes.csv";l.click();
}

document.querySelectorAll("input,select,textarea").forEach(x=>{
  x.oninput=calc;
  x.onchange=calc;
});

copyBtn.onclick=()=>{
  let t=calc();
  navigator.clipboard.writeText(
`MN Plowing Quote
Customer: ${custName.value}
Address: ${custAddr.value}
Driveway: ${drvOut.textContent}
Sidewalk: ${swOut.textContent}
Total: ${totOut.textContent}
Notes: ${notes.value}`
  );
  alert("Copied");
};

clearBtn.onclick=()=>{
  custName.value="";
  custAddr.value="";
  zone.value="";
  drvMin.value="";
  swMin.value="0";
  notes.value="";
  targetHr.value="400";
  minDrv.value="35";
  swRate.value="4";
  service.value="plow";
  calc();
};

saveBtn.onclick=saveQuote;
exportBtn.onclick=exportCSV;
clearSavedBtn.onclick=()=>{localStorage.removeItem(SAVED);renderSaved();};

calc();
renderSaved();
</script>

</body>
</html>
