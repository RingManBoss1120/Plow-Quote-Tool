<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>MN Plowing Quote Tool</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-180.png">

<style>
body{font-family:system-ui,-apple-system,BlinkMacSystemFont; background:#f4f6f8; margin:0; padding:12px;}
.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:14px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
.row{margin-bottom:10px}
label{font-weight:600}
input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;font-size:16px}
button{padding:12px 16px;border-radius:12px;border:0;background:#111;color:#fff;font-weight:700;font-size:16px}
button.ghost{background:#eee;color:#111}
.muted{color:#666;font-size:13px}
</style>
</head>

<body>

<div class="card">
<label>Customer / Address</label>
<input id="cust" list="custList" placeholder="123 Main St">
<datalist id="custList"></datalist>

<label>Zone / Cluster</label>
<input id="zone">

<label>Service</label>
<select id="service">
<option value="plow">Driveway only</option>
<option value="sidewalk">Sidewalk only</option>
<option value="plow_sw">Driveway + Sidewalk</option>
</select>
</div>

<div class="card">
<label><b>Driveway minutes</b></label>
<input id="drvMin" type="number" placeholder="ex: 4">

<label>Target $ / hour</label>
<input id="targetHr" value="400">

<label>Minimum driveway charge</label>
<input id="minDrv" value="35">
</div>

<div class="card">
<label>Sidewalk minutes</label>
<input id="swMin" value="0">

<label>Sidewalk $ per minute</label>
<input id="swRate" value="4">
</div>

<div class="card">
<div>Driveway: <b id="drvOut">$0</b></div>
<div>Sidewalk: <b id="swOut">$0</b></div>
<div>Total: <b id="totOut">$0</b></div>
</div>

<div class="card">
<label>Notes</label>
<textarea id="notes"></textarea>
</div>

<div class="card">
<button id="copyBtn">Copy Quote</button>
<button id="clearBtn" class="ghost">Clear</button>
</div>

<div class="card">
<b>Saved Quotes</b>
<div class="row">
<button id="saveQuoteBtn">Save this quote</button>
<button id="exportQuotesBtn" class="ghost">Export CSV</button>
<button id="clearQuotesBtn" class="ghost">Clear saved</button>
</div>
<div id="savedQuotesList"></div>
</div>

<script>
function money(n){return "$"+Math.round(n)}

const FIELDS=["cust","zone","service","drvMin","targetHr","minDrv","swMin","swRate","notes"]
const CUR="mn_current"
const SAVED="mn_saved"

function load(){
 let s=JSON.parse(localStorage.getItem(CUR)||"{}")
 FIELDS.forEach(i=>{if(document.getElementById(i))document.getElementById(i).value=s[i]||""})
}

function save(){
 let s={}
 FIELDS.forEach(i=>s[i]=document.getElementById(i).value)
 localStorage.setItem(CUR,JSON.stringify(s))
}

function getSaved(){return JSON.parse(localStorage.getItem(SAVED)||"[]")}
function setSaved(x){localStorage.setItem(SAVED,JSON.stringify(x))}

function calc(){
 let perMin=document.getElementById("targetHr").value/60
 let drvMin=+document.getElementById("drvMin").value||0
 let minDrv=+document.getElementById("minDrv").value||0

 let drv=drvMin*perMin
 if(drvMin>0) drv=Math.max(drv,minDrv)

 let swMin=+document.getElementById("swMin").value||0
 let swRate=+document.getElementById("swRate").value||0
 let sw=swMin*swRate

 document.getElementById("drvOut").textContent=money(drv)
 document.getElementById("swOut").textContent=money(sw)

 let s=document.getElementById("service").value
 let tot=s=="plow"?drv:s=="sidewalk"?sw:drv+sw

 document.getElementById("totOut").textContent=money(tot)
 save()
 return {drv,sw,tot}
}

function renderSaved(){
 let box=document.getElementById("savedQuotesList")
 let arr=getSaved().reverse()
 box.innerHTML=arr.length?arr.map((q,i)=>`
<div class="card">
<b>${q.cust}</b><br>
Total: ${money(q.tot)}<br>
<button onclick="loadQ(${i})" class="ghost">Load</button>
<button onclick="delQ(${i})" class="ghost">Delete</button>
</div>`).join(""):"<div class='muted'>No saved quotes</div>"

 document.getElementById("custList").innerHTML=[...new Set(arr.map(q=>q.cust))]
 .map(a=>`<option value="${a}">`).join("")
}

function saveQ(){
 let cust=document.getElementById("cust").value
 if(!cust){alert("Enter address");return}
 let {drv,sw,tot}=calc()
 let q={}
 FIELDS.forEach(i=>q[i]=document.getElementById(i).value)
 q.drv=drv;q.sw=sw;q.tot=tot
 setSaved([...getSaved(),q])
 renderSaved()
}

function loadQ(i){
 let q=getSaved().reverse()[i]
 FIELDS.forEach(f=>document.getElementById(f).value=q[f])
 calc()
}

function delQ(i){
 let a=getSaved().reverse()
 a.splice(i,1)
 setSaved(a.reverse())
 renderSaved()
}

document.querySelectorAll("input,select,textarea").forEach(x=>x.oninput=calc)

document.getElementById("copyBtn").onclick=()=>{
 let t=`MN Plowing Quote\nAddress: ${cust.value}\nDriveway: ${drvOut.textContent}\nSidewalk: ${swOut.textContent}\nTotal: ${totOut.textContent}`
 navigator.clipboard.writeText(t)
 alert("Copied")
}

document.getElementById("clearBtn").onclick=()=>{
 FIELDS.forEach(i=>document.getElementById(i).value="")
 calc()
}

document.getElementById("saveQuoteBtn").onclick=saveQ
document.getElementById("exportQuotesBtn").onclick=()=>{
 let a=getSaved()
 let csv="Address,Total\n"+a.map(x=>`${x.cust},${x.tot}`).join("\n")
 let b=new Blob([csv]);let u=URL.createObjectURL(b)
 let l=document.createElement("a");l.href=u;l.download="quotes.csv";l.click()
}
document.getElementById("clearQuotesBtn").onclick=()=>{localStorage.removeItem(SAVED);renderSaved()}

load()
calc()
renderSaved()
</script>

</body>
</html>
