<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  
  <!-- iPhone / iPad friendly "Add to Home Screen" support -->
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="MN Plowing Quote"/>
  <meta name="theme-color" content="#111111"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="apple-touch-icon" href="icons/icon-180.png"/>
<title>MN Plowing – Quick Quote (Phone)</title>
  <style>
    body{font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; margin:16px; max-width:760px;}
    h1{font-size:20px; margin:0 0 10px;}
    .card{border:1px solid #ddd; border-radius:14px; padding:14px; margin:12px 0;}
    label{display:block; font-weight:600; margin:10px 0 6px;}
    input, select, textarea{width:100%; padding:10px; border:1px solid #ccc; border-radius:10px; font-size:16px;}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    .out{font-size:18px; font-weight:700; padding:10px; background:#f5f5f5; border-radius:10px;}
    button{padding:12px 14px; border:0; border-radius:12px; font-size:16px; font-weight:700; cursor:pointer;}
    .btn{background:#111; color:#fff;}
    .muted{color:#555; font-size:13px; line-height:1.35;}
    .pill{display:inline-block; padding:3px 8px; border-radius:999px; background:#eee; font-size:12px; margin-left:6px;}
  </style>
</head>
<body>
  <h1>MN Plowing – Quick Quote (Phone)</h1>
  <div class="muted">Built from your economics: <b>$400/hr</b> truck target (~<b>$6.67/min</b>), sidewalks priced at <b>$4–$5/min</b>. This is a field tool—final quote is editable.</div>

  <div class="card" style="background:#fafafa;">
    <div class="muted" style="margin:0;">
      <b>iPhone tip:</b> if you open this from a web link (HTTPS), tap <b>Share</b> → <b>Add to Home Screen</b> to use it like an app.
      If you open it as a local file, the <b>Copy</b> button may be limited by iOS security.
    </div>
  </div>


  <div class="card">
    <div class="row">
      <div>
        <label>Customer / Address</label>
        <input id="cust" placeholder="Name + address"/>
      </div>
      <div>
        <label>Zone / Cluster</label>
        <input id="zone" placeholder="e.g., Piedmont Core / West / East / Superior"/>
      </div>
    </div>

    <label>Service Type</label>
    <select id="service">
      <option value="plow">Driveway plow</option>
      <option value="plow_sw">Plow + sidewalk/walkways</option>
      <option value="sidewalk">Sidewalk/walkways only</option>
    </select>
  </div>

  <div class="card">
    <h2 style="font-size:16px;margin:0 0 8px;">Driveway (plow)</h2>
    <div class="row">
      <div>
        <label>Driveway size</label>
        <select id="drvSize">
          <option value="2">Small (2 min) – recommended $35 min</option>
          <option value="4">Medium (4 min) – recommended $40–$45</option>
          <option value="7">Large (7 min) – recommended $50–$60</option>
          <option value="15">XL (15 min) – recommended $110–$140+</option>
        </select>
      </div>
      <div>
        <label>Override minutes (optional)</label>
        <input id="drvMin" type="number" min="0" step="1" placeholder="Leave blank to use size minutes"/>
      </div>
    </div>
    <div class="row">
      <div>
        <label>Target $/hr</label>
        <input id="targetHr" type="number" value="400"/>
      </div>
      <div>
        <label>Minimum driveway charge</label>
        <input id="minDrv" type="number" value="35"/>
        <div class="muted">Use $30 only as a <b>street-specific cluster promo</b>.</div>
      </div>
    </div>
    <label>Driveway quote</label>
    <div class="out" id="drvOut">$0</div>
  </div>

  <div class="card">
    <h2 style="font-size:16px;margin:0 0 8px;">Sidewalk / Walkways</h2>
    <div class="row">
      <div>
        <label>Estimated minutes</label>
        <input id="swMin" type="number" min="0" step="1" value="0"/>
      </div>
      <div>
        <label>Rate ($/min)</label>
        <select id="swRate">
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </div>
    </div>
    <label>Sidewalk quote</label>
    <div class="out" id="swOut">$0</div>
    <div class="muted">Estimator cheat-sheet: 50 ft frontage = 8–12 min; steps add 3–6 min/set; 4–8" multiply minutes x1.25; 8–12" x1.5.</div>
  </div>

  <div class="card">
    <h2 style="font-size:16px;margin:0 0 8px;">Total</h2>
    <label>Total quote per event</label>
    <div class="out" id="totOut">$0 <span class="pill" id="notePill">ok</span></div>

    <label>Notes</label>
    <textarea id="notes" rows="3" placeholder="Stacking issues, tight lot, extra entrances, depth multiplier used, etc."></textarea>

    <div class="row" style="margin-top:10px;">
      <button class="btn" id="copyBtn">Copy quote summary</button>
      <button id="clearBtn">Clear</button>
    </div>
  </div>


<script>
function money(n){ return "$" + (Math.round(n)).toLocaleString(); }

const FIELDS = ["cust","zone","service","drvSize","drvMin","targetHr","minDrv","swMin","swRate","notes"];
const LS_KEY = "mn_plowing_quote_v3";

function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);
    FIELDS.forEach(id=>{
      if(Object.prototype.hasOwnProperty.call(s, id) && document.getElementById(id)){
        document.getElementById(id).value = s[id];
      }
    });
  }catch(e){}
}

function saveState(){
  try{
    const s = {};
    FIELDS.forEach(id=>{
      const el = document.getElementById(id);
      if(el) s[id] = el.value;
    });
    localStorage.setItem(LS_KEY, JSON.stringify(s));
  }catch(e){}
}

function calc(){
  const targetHr = parseFloat(document.getElementById('targetHr').value || "400");
  const perMin = targetHr/60.0;

  const minDrv = parseFloat(document.getElementById('minDrv').value || "35");
  const sizeMin = parseFloat(document.getElementById('drvSize').value);
  const override = document.getElementById('drvMin').value;
  const drvMin = (override !== "" && !isNaN(parseFloat(override))) ? parseFloat(override) : sizeMin;

  let drvQuote = drvMin*perMin;
  if (drvMin > 0) drvQuote = Math.max(drvQuote, minDrv);

  const swMin = parseFloat(document.getElementById('swMin').value || "0");
  const swRate = parseFloat(document.getElementById('swRate').value || "4");
  const swQuote = swMin*swRate;

  document.getElementById('drvOut').textContent = money(drvQuote);
  document.getElementById('swOut').textContent = money(swQuote);

  const service = document.getElementById('service').value;
  let total = 0;
  if(service === "plow") total = drvQuote;
  if(service === "sidewalk") total = swQuote;
  if(service === "plow_sw") total = drvQuote + swQuote;

  document.getElementById('totOut').childNodes[0].textContent = money(total) + " ";

  // simple “capacity sanity” pill: if sidewalks > 45 min, warn
  const pill = document.getElementById('notePill');
  if(swMin >= 60){ pill.textContent="premium/avoid"; pill.style.background="#ffd6d6";}
  else if(swMin >= 45){ pill.textContent="high sidewalk load"; pill.style.background="#ffe7b3";}
  else { pill.textContent="ok"; pill.style.background="#eee";}

  saveState();
}

function buildSummaryText(){
  const cust = document.getElementById('cust').value;
  const zone = document.getElementById('zone').value;
  const service = document.getElementById('service').value;
  const drv = document.getElementById('drvOut').textContent;
  const sw = document.getElementById('swOut').textContent;
  const tot = document.getElementById('totOut').textContent.replace(/\s+/g,' ').trim();
  const notes = document.getElementById('notes').value;

  return `MN Plowing – Quote Summary
Customer/Address: ${cust}
Zone/Cluster: ${zone}
Service: ${service}
Driveway: ${drv}
Sidewalk: ${sw}
Total per event: ${tot}
Notes: ${notes}`;
}

async function copyText(txt){
  try{
    if(navigator.clipboard && window.isSecureContext){
      await navigator.clipboard.writeText(txt);
      return true;
    }
  }catch(e){}

  try{
    const ta = document.createElement("textarea");
    ta.value = txt;
    ta.setAttribute("readonly", "");
    ta.style.position = "fixed";
    ta.style.left = "-9999px";
    ta.style.top = "0";
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    ta.setSelectionRange(0, ta.value.length);
    const ok = document.execCommand("copy");
    document.body.removeChild(ta);
    if(ok) return true;
  }catch(e){}

  return false;
}

function showManualCopy(txt){
  const wrap = document.createElement("div");
  wrap.style.position = "fixed";
  wrap.style.left = "0";
  wrap.style.top = "0";
  wrap.style.right = "0";
  wrap.style.bottom = "0";
  wrap.style.background = "rgba(0,0,0,0.55)";
  wrap.style.zIndex = "9999";
  wrap.style.display = "flex";
  wrap.style.alignItems = "center";
  wrap.style.justifyContent = "center";
  wrap.style.padding = "16px";

  const card = document.createElement("div");
  card.style.background = "#fff";
  card.style.borderRadius = "14px";
  card.style.maxWidth = "760px";
  card.style.width = "100%";
  card.style.padding = "14px";

  const h = document.createElement("div");
  h.style.fontWeight = "700";
  h.style.marginBottom = "8px";
  h.textContent = "Copy (manual)";

  const p = document.createElement("div");
  p.style.fontSize = "13px";
  p.style.color = "#555";
  p.style.marginBottom = "8px";
  p.textContent = "Tap inside, then Select All → Copy.";

  const ta = document.createElement("textarea");
  ta.value = txt;
  ta.rows = 10;
  ta.style.width = "100%";
  ta.style.padding = "10px";
  ta.style.border = "1px solid #ccc";
  ta.style.borderRadius = "10px";
  ta.style.fontSize = "14px";

  const btnRow = document.createElement("div");
  btnRow.style.display = "flex";
  btnRow.style.gap = "10px";
  btnRow.style.justifyContent = "flex-end";
  btnRow.style.marginTop = "10px";

  const close = document.createElement("button");
  close.textContent = "Close";
  close.style.padding = "12px 14px";
  close.style.border = "0";
  close.style.borderRadius = "12px";
  close.style.fontSize = "16px";
  close.style.fontWeight = "700";
  close.style.cursor = "pointer";

  close.addEventListener("click", () => document.body.removeChild(wrap));

  btnRow.appendChild(close);
  card.appendChild(h);
  card.appendChild(p);
  card.appendChild(ta);
  card.appendChild(btnRow);
  wrap.appendChild(card);
  wrap.appendChild(wrap);
  // (fix) append card to wrap properly
  wrap.removeChild(wrap.lastChild)
  wrap.appendChild(card)

  document.body.appendChild(wrap);

  setTimeout(()=>{ ta.focus(); ta.select(); ta.setSelectionRange(0, ta.value.length); }, 50);
}

FIELDS.forEach(id=>{
  document.getElementById(id).addEventListener('input', calc);
  document.getElementById(id).addEventListener('change', calc);
});

document.getElementById('copyBtn').addEventListener('click', async () => {
  calc();
  const txt = buildSummaryText();
  const ok = await copyText(txt);
  if(ok) alert("Copied to clipboard.");
  else showManualCopy(txt);
});

document.getElementById('clearBtn').addEventListener('click', () => {
  ["cust","zone","drvMin","swMin","notes"].forEach(id=>document.getElementById(id).value="");
  document.getElementById('service').value="plow";
  document.getElementById('drvSize').value="2";
  document.getElementById('targetHr').value="400";
  document.getElementById('minDrv').value="35";
  document.getElementById('swRate').value="4";
  calc();
});

loadState();
calc();

if("serviceWorker" in navigator){
  window.addEventListener("load", ()=> {
    navigator.serviceWorker.register("./sw.js").catch(()=>{});
  });
}
</script>

</body>
</html>
