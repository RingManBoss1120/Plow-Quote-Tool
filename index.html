<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MN Plowing Quote Tool</title>

<link rel="icon" href="icons/icon-192-v2.png">
<link rel="apple-touch-icon" href="icons/icon-180-v2.png">

<style>
*{box-sizing:border-box;}

:root{
  --bg0:#05070c;
  --bg1:#070b14;
  --cardA:#0a1a35;
  --cardB:#07162e;
  --border:rgba(255,255,255,.10);
  --text:#eaf2ff;
  --muted:rgba(234,242,255,.70);
  --primary:#2b7bff;
  --danger:#ef4444;
}

body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  margin:0;
  padding:20px;
  color:var(--text);
  background:
    radial-gradient(900px 500px at 50% -10%, rgba(43,123,255,.35), transparent 55%),
    radial-gradient(700px 420px at 10% 30%, rgba(43,123,255,.18), transparent 60%),
    linear-gradient(180deg, var(--bg1), var(--bg0));
}

.wrap{
  max-width:760px;
  margin:0 auto;
}

.sectionTitle{
  margin:20px 6px 10px;
  color:var(--muted);
  font-weight:900;
  letter-spacing:1.2px;
  text-transform:uppercase;
  font-size:12px;
}
.sectionTitle::after{
  content:"";
  display:block;
  height:1px;
  width:100%;
  margin-top:6px;
  background:linear-gradient(90deg, transparent, rgba(43,123,255,.5), transparent);
}

/* Customer grid */
.customerGrid{
  display:grid;
  grid-template-columns: 1fr;
  gap:14px;
}
@media (min-width: 900px){
  .customerGrid{
    grid-template-columns: 1fr 1fr;
    gap:18px;
  }
}
.customerGrid .span2{
  grid-column: 1 / -1;
}

.card{
  border-radius:20px;
  padding:18px;
  margin-bottom:18px;
  transition: transform .18s ease, box-shadow .18s ease;
  will-change: transform;

  background:linear-gradient(180deg, rgba(10,26,53,.92), rgba(7,22,46,.92));
  border:1px solid var(--border);
  box-shadow:
    0 18px 50px rgba(0,0,0,.55),
    0 0 0 1px rgba(43,123,255,.08) inset,
    0 10px 22px rgba(43,123,255,.12);
  backdrop-filter: blur(8px);
}
.card:hover{
  transform: translateY(-2px);
  box-shadow:
    0 22px 60px rgba(0,0,0,.6),
    0 0 0 1px rgba(43,123,255,.12) inset,
    0 14px 30px rgba(43,123,255,.18);
}
.card:active{ transform: scale(.99); }

label{
  font-weight:700;
  display:block;
  margin-bottom:8px;
  color:var(--text);
  letter-spacing:.2px;
}

input,select,textarea{
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:14px;
  margin-bottom:12px;
  background:rgba(2,8,18,.55);
  border:1px solid rgba(255,255,255,.10);
  color:var(--text);
}

input::placeholder,
textarea::placeholder{
  color:rgba(234,242,255,.45);
}

input:focus,
select:focus,
textarea:focus{
  outline:none;
  border-color:rgba(43,123,255,.85);
  box-shadow:0 0 0 3px rgba(43,123,255,.22);
}

select{
  appearance:none;
  background-color: rgba(2,8,18,.55);
  background-image:
    linear-gradient(45deg, transparent 50%, rgba(234,242,255,.75) 50%),
    linear-gradient(135deg, rgba(234,242,255,.75) 50%, transparent 50%);
  background-position: calc(100% - 18px) 50%, calc(100% - 12px) 50%;
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  padding-right: 40px;
}

textarea{ resize:none; }

/* $ prefix input wrapper */
.moneyWrap{ position:relative; }
.moneyWrap::before{
  content:"$";
  position:absolute;
  left:14px;
  top:50%;
  transform:translateY(-50%);
  color:rgba(234,242,255,.55);
  font-weight:800;
  pointer-events:none;
}
.moneyInput{ padding-left:34px; }

button{
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:16px;
  border:none;
  font-weight:900;
  letter-spacing:.4px;
  color:#fff;
  background:linear-gradient(135deg, rgba(43,123,255,1), rgba(31,95,191,1));
  box-shadow:
    0 12px 26px rgba(43,123,255,.35),
    0 2px 0 rgba(255,255,255,.15) inset;
}
button:active{ transform:scale(.985); }

button.secondary{
  background:rgba(148,163,184,.22);
  color:rgba(234,242,255,.85);
  box-shadow:none;
  border:1px solid rgba(255,255,255,.12);
}

button.success{
  background:linear-gradient(135deg, rgba(16,185,129,1), rgba(5,150,105,1));
  box-shadow:
    0 12px 26px rgba(16,185,129,.22),
    0 2px 0 rgba(255,255,255,.12) inset;
}

.actionsGrid{
  display:grid;
  grid-template-columns: 1fr;
  gap:12px;
}
@media (min-width: 720px){
  .actionsGrid{
    grid-template-columns: 1fr 1fr 1fr;
  }
}

.row{
  display:flex;
  justify-content:space-between;
  font-size:18px;
  padding:6px 0;
  color:rgba(234,242,255,.90);
}

.divider{
  height:1px;
  background:rgba(255,255,255,.10);
  margin:12px 0;
}

.totalRow{
  font-size:26px;
  font-weight:950;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding-top:8px;
}
#totalAmount{
  color:var(--primary);
  text-shadow:
    0 0 18px rgba(43,123,255,.55),
    0 0 32px rgba(43,123,255,.25);
}

@keyframes pulseGlow{
  0%{ text-shadow:0 0 0 rgba(43,123,255,0); }
  50%{ text-shadow:0 0 22px rgba(43,123,255,.7); }
  100%{ text-shadow:0 0 0 rgba(43,123,255,0); }
}
.totalPulse{ animation: pulseGlow .45s ease; }

.tagline{
  margin-top:10px;
  font-weight:950;
  text-transform:uppercase;
  color:rgba(234,242,255,.95);
  text-shadow:0 0 22px rgba(43,123,255,.22);
  white-space:nowrap;
  padding:0 10px;
  max-width:100%;
  font-size:clamp(18px, 4.8vw, 28px);
  letter-spacing:clamp(.5px, .8vw, 2px);
  line-height:1.1;
}

/* MOBILE: tighten the logo header so sections sit higher */
@media (max-width: 520px){
  body{ padding:14px; }
  .logoCard{ padding:14px !important; margin-bottom:14px; }
  .logoCard img{ max-width:260px !important; }
  .tagline{ font-size:20px; letter-spacing:1.5px; margin-top:8px; }
}
</style>
</head>

<body>
<div class="wrap">

<!-- LOGO -->
<div class="card logoCard" style="
  text-align:center;
  padding:20px;
  background:linear-gradient(135deg,#0b1f43,#07162e);
">
  <img src="MN%20Plowing%20Logo%20no%20back.png"
       alt="MN Plowing"
       style="max-width:320px;width:100%;filter:drop-shadow(0 10px 18px rgba(0,0,0,.65));">
  <div class="tagline">"THE BLIZZARD BUSTERS"</div>
</div>

<!-- CUSTOMER -->
<div class="sectionTitle">Customer</div>
<div class="card">
  <div class="customerGrid">

    <div>
      <label>Customer Last Name</label>
      <input id="lastName" autocomplete="family-name">
    </div>

    <div>
      <label>Customer First Name</label>
      <input id="firstName" autocomplete="given-name">
    </div>

    <div class="span2">
      <label>Name of Business</label>
      <input id="businessName" placeholder="N/A">
    </div>

    <div>
      <label>Customer Email</label>
      <input id="customerEmail" type="email" autocomplete="email">
    </div>

    <div>
      <label>Customer Phone</label>
      <input id="customerPhone" type="tel" autocomplete="off" inputmode="tel">
    </div>

    <div class="span2">
      <label>Service Street Address</label>
      <input id="street" autocomplete="street-address">
    </div>

    <div>
      <label>City</label>
      <select id="city">
        <option value="Duluth" selected>Duluth</option>
        <option value="Hermantown">Hermantown</option>
        <option value="Superior">Superior</option>
        <option value="Proctor">Proctor</option>
      </select>
    </div>

    <div>
      <label>State</label>
      <select id="state">
        <option value="MN" selected>MN</option>
        <option value="WI">WI</option>
      </select>
    </div>

    <div class="span2">
      <label>Zip Code</label>
      <input id="zip" inputmode="numeric" autocomplete="postal-code">
    </div>

    <div class="span2">
      <label>Notes</label>
      <textarea class="span2" id="notes" rows="4" placeholder="Notes (gate code, special instructions, pricing notes, follow-up, etc.)"></textarea>
    </div>

  </div>
</div>

<!-- SERVICE -->
<div class="sectionTitle">Type of Service</div>
<div class="card">
  <label>Service</label>
  <select id="service">
    <option value="both">Driveway + Sidewalk</option>
    <option value="driveway">Driveway Only</option>
    <option value="sidewalk">Sidewalk Only</option>
  </select>
</div>

<!-- DRIVEWAY -->
<div class="sectionTitle">Driveway</div>
<div class="card">
  <label>Driveway Minutes</label>
  <input id="driveMinutes" type="number" inputmode="numeric">

  <label>Driveway $ / Hour</label>
  <input id="driveRate" type="number" inputmode="decimal" value="400">
</div>

<!-- SIDEWALK -->
<div class="sectionTitle">Sidewalk</div>
<div class="card">
  <label>Sidewalk Minutes</label>
  <input id="sideMinutes" type="number" inputmode="numeric">

  <label>Sidewalk $ / Minute</label>
  <select id="sideRate">
    <option value="4">$4</option>
    <option value="5" selected>$5</option>
    <option value="6">$6</option>
    <option value="7">$7</option>
    <option value="8">$8</option>
  </select>
</div>

<!-- SALTING -->
<div class="sectionTitle">Salting Services</div>
<div class="card">
  <label>Salting (optional)</label>
  <div class="moneyWrap">
    <input id="saltAmount" class="moneyInput" placeholder="N/A" inputmode="decimal">
  </div>
</div>

<!-- PRICING RULES -->
<div class="sectionTitle">Pricing Rules</div>
<div class="card">
  <label style="display:flex; gap:10px; align-items:center; margin-bottom:12px;">
    <input id="enforceMinimums" type="checkbox" checked style="width:auto; margin:0;">
    Enforce minimum charges (Plow $30 / Shovel $25 / Salt $30)
  </label>

  <div class="customerGrid">
    <div>
      <label>Minimum Plow (Driveway)</label>
      <div class="moneyWrap">
        <input id="minPlow" class="moneyInput" inputmode="decimal" value="30">
      </div>
    </div>

    <div>
      <label>Minimum Shovel (Sidewalk)</label>
      <div class="moneyWrap">
        <input id="minShovel" class="moneyInput" inputmode="decimal" value="25">
      </div>
    </div>

    <div class="span2">
      <label>Minimum Salt</label>
      <div class="moneyWrap">
        <input id="minSalt" class="moneyInput" inputmode="decimal" value="30">
      </div>
    </div>

    <div class="span2">
      <label>Round Total</label>
      <select id="roundMode">
        <option value="none" selected>No rounding</option>
        <option value="5">Round to nearest $5</option>
        <option value="10">Round to nearest $10</option>
      </select>
    </div>
  </div>
</div>

<!-- PRICING -->
<div class="sectionTitle">Pricing</div>
<div class="card">
  <div class="row" id="driveLine">
    <span>Driveway</span>
    <span id="drivePrice">$0.00</span>
  </div>

  <div class="row" id="sideLine">
    <span>Sidewalk</span>
    <span id="sidePrice">$0.00</span>
  </div>

  <div class="row" id="saltLine" style="display:none;">
    <span>Salting</span>
    <span id="saltPrice">$0.00</span>
  </div>

  <div class="divider"></div>

  <div class="totalRow">
    <span>Total</span>
    <span id="totalAmount">$0.00</span>
  </div>
</div>

<!-- ACTIONS -->
<div class="sectionTitle">Actions</div>
<div class="card">
  <div class="actionsGrid">
    <button id="emailBtn" onclick="emailQuote()">Email Quote</button>
    <button id="summaryBtn" class="success" onclick="openQuoteSummary()">Quote Summary</button>
    <button class="secondary" onclick="clearAll()">Clear</button>
  </div>
</div>

<!-- QUOTE SUMMARY MODAL -->
<div id="quoteModal" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  padding:18px;
  z-index:9999;
">
  <div class="card" style="max-width:760px;margin:0 auto;">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <div style="font-weight:950;letter-spacing:.3px;">Quote Summary</div>
      <button class="secondary" style="width:auto;padding:10px 14px;" onclick="closeQuoteSummary()">Close</button>
    </div>

    <div class="divider"></div>

    <label>Preview</label>
    <select id="previewMode">
      <option value="internal" selected>Internal (includes notes)</option>
      <option value="customer">Customer-facing (no notes)</option>
    </select>

    <label>Quote Text</label>
    <textarea id="quoteText" rows="14" readonly></textarea>

    <div class="actionsGrid" style="margin-top:10px;">
      <button id="copyInternalBtn" onclick="copyInternal()">Copy Internal Quote</button>
      <button id="copyCustomerBtn" class="success" onclick="copyCustomer()">Copy Customer Quote</button>
      <button class="secondary" onclick="emailQuote()">Try Email</button>
    </div>
  </div>
</div>

<script>
/* Elements */
const service = document.getElementById("service");
const driveMinutes = document.getElementById("driveMinutes");
const driveRate = document.getElementById("driveRate");
const sideMinutes = document.getElementById("sideMinutes");
const sideRate = document.getElementById("sideRate");
const saltAmount = document.getElementById("saltAmount");

const enforceMinimums = document.getElementById("enforceMinimums");
const minPlow = document.getElementById("minPlow");
const minShovel = document.getElementById("minShovel");
const minSalt = document.getElementById("minSalt");
const roundMode = document.getElementById("roundMode");

const driveLine = document.getElementById("driveLine");
const sideLine = document.getElementById("sideLine");
const saltLine = document.getElementById("saltLine");

const drivePrice = document.getElementById("drivePrice");
const sidePrice = document.getElementById("sidePrice");
const saltPrice = document.getElementById("saltPrice");
const totalAmount = document.getElementById("totalAmount");

const lastName = document.getElementById("lastName");
const firstName = document.getElementById("firstName");
const businessName = document.getElementById("businessName");
const customerEmail = document.getElementById("customerEmail");
const customerPhone = document.getElementById("customerPhone");
const street = document.getElementById("street");
const city = document.getElementById("city");
const state = document.getElementById("state");
const zip = document.getElementById("zip");
const notes = document.getElementById("notes");

/* Quote modal */
const quoteModal = document.getElementById("quoteModal");
const quoteText = document.getElementById("quoteText");
const previewMode = document.getElementById("previewMode");

/* State */
let lastTotals = {
  dCost: 0,
  sCost: 0,
  saltCost: 0,
  totalBeforeRounding: 0,
  totalFinal: 0
};

/* Helpers */
function money(n){
  const v = Number(n || 0);
  return "$" + v.toFixed(2);
}

function sanitizeCurrency(raw){
  let s = (raw || "").trim();
  if (!s) return "";

  if (/^(n\/a|na|none)$/i.test(s)) return "";

  s = s.replace(/\s+/g, "").replace(/\$/g, "");

  if (s.includes(",") && !s.includes(".")) {
    s = s.replace(",", ".");
  } else {
    s = s.replace(/,/g, "");
  }

  const n = parseFloat(s);
  if (!Number.isFinite(n)) return "";

  return n.toFixed(2);
}

function formatCustomer(){
  const ln = (lastName.value || "").trim();
  const fn = (firstName.value || "").trim();
  if(!ln && !fn) return "";
  if(ln && fn) return `${ln}, ${fn}`;
  return ln || fn;
}

function formatAddress(){
  const st = (street.value || "").trim();
  const c = (city.value || "").trim();
  const s = (state.value || "").trim();
  const z = (zip.value || "").trim();

  const line1 = st;
  const line2 = [c, s].filter(Boolean).join(", ") + (z ? ` ${z}` : "");
  return [line1, line2].filter(Boolean).join("\n");
}

function getRoundingIncrement(){
  const mode = roundMode.value;
  if (mode === "5") return 5;
  if (mode === "10") return 10;
  return 0;
}

function roundToIncrement(value, inc){
  if (!inc) return value;
  return Math.round(value / inc) * inc;
}

/* Quote text builders */
function buildQuoteText(){
  const cust = formatCustomer() || "—";
  const biz = (businessName.value || "").trim() || "N/A";
  const em = (customerEmail.value || "").trim() || "—";
  const ph = (customerPhone.value || "").trim() || "—";
  const addr = formatAddress() || "—";
  const note = (notes.value || "").trim() || "—";

  const lines = [];
  if (driveLine.style.display !== "none") lines.push(`Driveway: ${drivePrice.textContent}`);
  if (sideLine.style.display !== "none") lines.push(`Sidewalk: ${sidePrice.textContent}`);
  if (saltLine.style.display !== "none") lines.push(`Salting: ${saltPrice.textContent}`);

  const inc = getRoundingIncrement();
  if (inc) {
    lines.push(`Subtotal (calculated): ${money(lastTotals.totalBeforeRounding)}`);
    lines.push(`Total (rounded): ${money(lastTotals.totalFinal)}`);
  } else {
    lines.push(`Total: ${money(lastTotals.totalFinal)}`);
  }

  return `Quick Quote Provided by
MN Plowing LLC

Customer: ${cust}
Business: ${biz}
Email: ${em}
Phone: ${ph}

Address:
${addr}

Notes:
${note}

${lines.join("\n")}

Thank you for your interest in MN Plowing Snow Removal Services.

Please contact Nick Altiere at:
Phone: 218-349-3737
Email: info@mnplowing.com`;
}

function buildCustomerQuoteText(){
  const cust = formatCustomer();
  const biz = (businessName.value || "").trim() || "N/A";
  const addr = formatAddress() || "—";

  const lines = [];
  if (driveLine.style.display !== "none") lines.push(`Driveway: ${drivePrice.textContent}`);
  if (sideLine.style.display !== "none") lines.push(`Sidewalk: ${sidePrice.textContent}`);
  if (saltLine.style.display !== "none") lines.push(`Salting: ${saltPrice.textContent}`);
  lines.push(`Total: ${money(lastTotals.totalFinal)}`);

  return `MN Plowing LLC – Quick Quote

${cust ? `Customer: ${cust}\n` : ""}Business: ${biz}

Service Address:
${addr}

${lines.join("\n")}

If you’d like to move forward, reply to confirm service type and any special instructions.
Nick Altiere – MN Plowing LLC
218-349-3737
info@mnplowing.com`;
}

/* Calculation */
function calc(){
  const dMin = Math.max(0, Number(driveMinutes.value || 0));
  const dRate = Math.max(0, Number(driveRate.value || 400));
  const sMin = Math.max(0, Number(sideMinutes.value || 0));
  const sRate = Math.max(0, Number(sideRate.value || 0));

  let dCost = (dRate/60) * dMin;
  let sCost = sMin * sRate;

  const saltNum = parseFloat((saltAmount.value || "").trim());
  let saltCost = (Number.isFinite(saltNum) ? saltNum : 0);

  if (enforceMinimums && enforceMinimums.checked) {
    const minPlowVal = Math.max(0, parseFloat(sanitizeCurrency(minPlow.value)) || 0);
    const minShovelVal = Math.max(0, parseFloat(sanitizeCurrency(minShovel.value)) || 0);
    const minSaltVal = Math.max(0, parseFloat(sanitizeCurrency(minSalt.value)) || 0);

    if (dMin > 0) dCost = Math.max(dCost, minPlowVal);
    if (sMin > 0) sCost = Math.max(sCost, minShovelVal);
    if (saltCost > 0) saltCost = Math.max(saltCost, minSaltVal);
  }

  let totalBeforeRounding = 0;

  if(service.value === "both"){
    driveLine.style.display = "flex";
    sideLine.style.display = "flex";
    totalBeforeRounding = dCost + sCost + saltCost;
  } else if(service.value === "driveway"){
    driveLine.style.display = "flex";
    sideLine.style.display = "none";
    totalBeforeRounding = dCost + saltCost;
  } else {
    driveLine.style.display = "none";
    sideLine.style.display = "flex";
    totalBeforeRounding = sCost + saltCost;
  }

  if (saltCost > 0) {
    saltLine.style.display = "flex";
  } else {
    saltLine.style.display = "none";
  }

  const inc = getRoundingIncrement();
  const totalFinal = roundToIncrement(totalBeforeRounding, inc);

  lastTotals = { dCost, sCost, saltCost, totalBeforeRounding, totalFinal };

  drivePrice.textContent = money(dCost);
  sidePrice.textContent = money(sCost);
  saltPrice.textContent = money(saltCost);
  totalAmount.textContent = money(totalFinal);

  totalAmount.classList.remove("totalPulse");
  void totalAmount.offsetWidth;
  totalAmount.classList.add("totalPulse");

  // keep modal preview fresh if open
  if (quoteModal.style.display === "block") updateQuotePreview();
}

/* Sanitization: salt on blur */
saltAmount.addEventListener("blur", () => {
  const cleaned = sanitizeCurrency(saltAmount.value);
  saltAmount.value = cleaned; // blank if invalid
  calc();
});

/* Optional: sanitize minimum fields on blur too */
[minPlow, minShovel, minSalt].forEach(el => {
  el.addEventListener("blur", () => {
    const cleaned = sanitizeCurrency(el.value);
    if (cleaned) el.value = cleaned;
    calc();
  });
});

/* Events */
[
  service, driveMinutes, driveRate, sideMinutes, sideRate,
  saltAmount, enforceMinimums, minPlow, minShovel, minSalt, roundMode
].forEach(el=>{
  el.addEventListener("input", calc);
  el.addEventListener("change", calc);
});

/* Actions */
function clearAll(){
  lastName.value = "";
  firstName.value = "";
  businessName.value = "";
  customerEmail.value = "";

  customerPhone.value = "";
  customerPhone.blur();
  setTimeout(() => { customerPhone.value = ""; }, 0);

  street.value = "";
  city.value = "Duluth";
  state.value = "MN";
  zip.value = "";
  notes.value = "";

  saltAmount.value = "";
  saltLine.style.display = "none";

  driveMinutes.value = "";
  sideMinutes.value = "";

  closeQuoteSummary();
  calc();
}

function emailQuote(){
  const subject = `MN Plowing Quick Quote – ${formatCustomer() || "Customer"}`;
  const body = buildQuoteText();

  const cc = (customerEmail.value || "").trim();

  const mailto =
    "mailto:info@mnplowing.com" +
    "?subject=" + encodeURIComponent(subject) +
    (cc ? "&cc=" + encodeURIComponent(cc) : "") +
    "&body=" + encodeURIComponent(body);

  window.location.href = mailto;
}

/* Quote summary modal */
function openQuoteSummary(){
  quoteModal.style.display = "block";
  updateQuotePreview();
}

function closeQuoteSummary(){
  quoteModal.style.display = "none";
}

function updateQuotePreview(){
  const mode = previewMode.value;
  quoteText.value = (mode === "customer") ? buildCustomerQuoteText() : buildQuoteText();
}

previewMode.addEventListener("change", updateQuotePreview);

async function copyTextToClipboard(text, successBtn){
  try{
    await navigator.clipboard.writeText(text);
  } catch(e){
    const ta = document.createElement("textarea");
    ta.value = text;
    ta.style.position = "fixed";
    ta.style.left = "-9999px";
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    document.execCommand("copy");
    document.body.removeChild(ta);
  }

  if (successBtn) {
    const original = successBtn.textContent;
    successBtn.textContent = "Copied!";
    setTimeout(() => { successBtn.textContent = original; }, 1200);
  }
}

function copyInternal(){
  const btn = document.getElementById("copyInternalBtn");
  copyTextToClipboard(buildQuoteText(), btn);
}

function copyCustomer(){
  const btn = document.getElementById("copyCustomerBtn");
  copyTextToClipboard(buildCustomerQuoteText(), btn);
}

/* Init */
calc();
</script>

</div>
</body>
</html>
